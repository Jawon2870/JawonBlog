# 劫持并修改https响应体（四）

下面继续基于 electron 进行尝试。

### 代理劫持 html

看到这篇文章 [内容劫持 | Electron 安全-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2411206)，我想能否通过 https 代理来劫持并修改响应体呢？经过尝试，修改 host 设置代理劫持的方式很不稳定，受 dns 缓存和系统其他代理软件的影响较大，所以也不是一个很好的方案。

### 本地加载 html

偶然间我想到，为什么不使用 electron 直接加载修改过的 html，我的最终需求是去除页面 html 中的 CSP，没必要非得实现劫持。

如果使用 electron 窗口来加载目标网站的 html，那么就会出现下面的问题：

1. html 中使用相对路径加载的资源将会出现路径错误。
2. 页面中的 Ajax 请求如果使用了相对路径，同样会出现路径错误。
3. 页面中的 webSocket 请求同样存在以上问题。
4. 页面中使用 js 动态创建的 worker 是否仍能正常运行，尚不明确。

要想实现目标需求，就必须解决以上问题，那么开始解决吧！

1. 首先将 html 中所有使用相对路径的资源路径前面补上对应的协议和域名，从而解决第一个问题。
2. . . . 

经过尝试发现，这些问题似乎很难解决，让我觉得这不是一条走得通的路，于是我暂时放弃。

大概在4月20多号，我终于解决了，虽然最终也没能实现直接劫持 html，但我使用了一些巧妙的方法，间接地劫持了 html，可以任意修改服务器返回的 html，之后交给浏览器解析，并且不会出现以上的资源问题，页面正常运行。当然，也成功去除了[文章一中所提到的去除 html 中的 CSP 规则](https://www.jawon.site/docs/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E5%8A%AB%E6%8C%81%E5%B9%B6%E4%BF%AE%E6%94%B9https%E5%93%8D%E5%BA%94%E4%BD%93/%E5%8A%AB%E6%8C%81%E5%B9%B6%E4%BF%AE%E6%94%B9https%E5%93%8D%E5%BA%94%E4%BD%93%EF%BC%881%EF%BC%89)。如果需要此方案，可以通过 jawon2870@qq.com 联系我！

---

创建时间：2025年4月18日

更新时间：2025年4月18日
